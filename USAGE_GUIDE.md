# Juya Agent ä½¿ç”¨æŒ‡å—

## å¿«é€Ÿå¼€å§‹

### æ–¹å¼ä¸€ï¼šå¯¹è¯æœºå™¨äººæ¨¡å¼ï¼ˆæ¨èï¼‰

æœ€ç®€å•çš„ä½¿ç”¨æ–¹å¼ï¼ŒåƒèŠå¤©ä¸€æ ·ä¸ Agent äº¤äº’ï¼š

```bash
python chat.py
```

å¯åŠ¨åä½ å¯ä»¥ï¼š
- ğŸ’¬ è‡ªç„¶è¯­è¨€å¯¹è¯
- ğŸ“‹ åˆ›å»ºå’Œç®¡ç†å®šæ—¶ä»»åŠ¡
- ğŸ¬ æ£€æŸ¥è§†é¢‘ã€ç”Ÿæˆæ—©æŠ¥ã€å‘é€é‚®ä»¶
- ğŸ”„ å®šæ—¶ä»»åŠ¡ä¼šåœ¨åå°è‡ªåŠ¨è§¦å‘

#### å¯¹è¯ç¤ºä¾‹

```
ğŸ’¬ ä½ : æ£€æŸ¥æ©˜é¸¦æœ‰æ²¡æœ‰æ–°è§†é¢‘
ğŸ¤– Juya Agent: æ­£åœ¨æ£€æŸ¥...
[Agent è°ƒç”¨ check_new_videos å·¥å…·]

ğŸ’¬ ä½ : æ¯å¤©æ—©ä¸Š9ç‚¹è‡ªåŠ¨æ£€æŸ¥æ–°è§†é¢‘å¹¶å‘é€æ—©æŠ¥
ğŸ¤– Juya Agent: å·²åˆ›å»ºå®šæ—¶ä»»åŠ¡...
[Agent è°ƒç”¨ create_task å·¥å…·]

ğŸ’¬ ä½ : åˆ—å‡ºæ‰€æœ‰å®šæ—¶ä»»åŠ¡
ğŸ¤– Juya Agent: ä»¥ä¸‹æ˜¯æ‚¨çš„å®šæ—¶ä»»åŠ¡...
[Agent è°ƒç”¨ list_tasks å·¥å…·]

ğŸ’¬ ä½ : exit
ğŸ‘‹ å†è§ï¼
```

### æ–¹å¼äºŒï¼šå•æ¬¡å‘½ä»¤æ¨¡å¼

é€‚åˆåªæ‰§è¡Œä¸€æ¬¡ä»»åŠ¡çš„åœºæ™¯ï¼š

```bash
# ä¸ä¿æŒè¿è¡Œï¼Œæ‰§è¡Œå®Œå³é€€å‡º
python run_with_sampling.py --query "åˆ—å‡ºæ‰€æœ‰å®šæ—¶ä»»åŠ¡" --no-keep-alive

# æ‰§è¡Œåä¿æŒè¿è¡Œï¼Œç­‰å¾…å®šæ—¶ä»»åŠ¡è§¦å‘
python run_with_sampling.py --query "æ¯å¤©æ—©ä¸Š9ç‚¹æ£€æŸ¥æ–°è§†é¢‘"
```

### æ–¹å¼ä¸‰ï¼šæŒç»­æœåŠ¡æ¨¡å¼

é€‚åˆä½œä¸ºåå°æœåŠ¡è¿è¡Œï¼Œåªæ¥æ”¶å®šæ—¶ä»»åŠ¡ï¼š

```bash
# ä¸æ‰§è¡Œä»»ä½•åˆå§‹æŸ¥è¯¢ï¼Œåªç­‰å¾…å®šæ—¶ä»»åŠ¡
python run_with_sampling.py

# æˆ–ä½¿ç”¨ nohup åå°è¿è¡Œ
nohup python run_with_sampling.py > juya.log 2>&1 &
```

## åŠŸèƒ½ä»‹ç»

### 1. è§†é¢‘ç›‘æ§åŠŸèƒ½

#### æ£€æŸ¥æ–°è§†é¢‘
```
ğŸ’¬ ä½ : æ£€æŸ¥æ©˜é¸¦çš„æ–°è§†é¢‘
```
Agent ä¼šè°ƒç”¨ `check_new_videos` å·¥å…·è·å–æœ€æ–°è§†é¢‘åˆ—è¡¨ã€‚

#### å¤„ç†è§†é¢‘ç”Ÿæˆæ—©æŠ¥
```
ğŸ’¬ ä½ : å¤„ç†è§†é¢‘ BV1234567890
```
Agent ä¼šï¼š
1. è·å–è§†é¢‘å­—å¹•æˆ–ç®€ä»‹
2. ä½¿ç”¨ AI æå–æ–°é—»è¦ç‚¹
3. ç”Ÿæˆ Markdown æ ¼å¼çš„ AI æ—©æŠ¥
4. ä¿å­˜åˆ°æœ¬åœ°æ–‡ä»¶

#### å‘é€é‚®ä»¶
```
ğŸ’¬ ä½ : å‘é€ BV1234567890 çš„æ—©æŠ¥åˆ°é‚®ç®±
```
Agent ä¼šè¯»å–å·²ç”Ÿæˆçš„æ—©æŠ¥å¹¶å‘é€åˆ°é…ç½®çš„é‚®ç®±ã€‚

#### å®Œæ•´æµç¨‹
```
ğŸ’¬ ä½ : æ£€æŸ¥æ–°è§†é¢‘ï¼Œå¦‚æœæœ‰å°±ç”Ÿæˆæ—©æŠ¥å¹¶å‘é€é‚®ä»¶
```
Agent ä¼šè‡ªåŠ¨æ‰§è¡Œå®Œæ•´çš„ä¸‰æ­¥æµç¨‹ã€‚

### 2. å®šæ—¶ä»»åŠ¡åŠŸèƒ½

#### åˆ›å»ºå®šæ—¶ä»»åŠ¡

ä½¿ç”¨è‡ªç„¶è¯­è¨€æè¿°ï¼š
```
ğŸ’¬ ä½ : æ¯å¤©æ—©ä¸Š9ç‚¹æ£€æŸ¥æ©˜é¸¦çš„æ–°è§†é¢‘å¹¶å‘é€æ—©æŠ¥
ğŸ’¬ ä½ : æ¯å°æ—¶æ£€æŸ¥ä¸€æ¬¡æ–°è§†é¢‘
ğŸ’¬ ä½ : æ˜å¤©ä¸‹åˆ3ç‚¹å¤„ç†è§†é¢‘ BV1234567890
ğŸ’¬ ä½ : æ¯å‘¨ä¸€æ—©ä¸Š8ç‚¹å‘é€æœ¬å‘¨è§†é¢‘æ±‡æ€»
```

Agent ä¼šè‡ªåŠ¨å°†è‡ªç„¶è¯­è¨€è½¬æ¢ä¸ºæ­£ç¡®çš„è§¦å‘å™¨é…ç½®ã€‚

#### åˆ—å‡ºæ‰€æœ‰ä»»åŠ¡
```
ğŸ’¬ ä½ : åˆ—å‡ºæ‰€æœ‰å®šæ—¶ä»»åŠ¡
ğŸ’¬ ä½ : æŸ¥çœ‹æˆ‘çš„å®šæ—¶ä»»åŠ¡
ğŸ’¬ ä½ : æœ‰å“ªäº›å®šæ—¶ä»»åŠ¡
```

#### æŸ¥çœ‹ä»»åŠ¡è¯¦æƒ…
```
ğŸ’¬ ä½ : æŸ¥çœ‹ä»»åŠ¡ task-xxx çš„è¯¦ç»†ä¿¡æ¯
ğŸ’¬ ä½ : ä»»åŠ¡ task-xxx çš„æ‰§è¡Œå†å²
```

#### ä¿®æ”¹ä»»åŠ¡
```
ğŸ’¬ ä½ : æŠŠæ¯å¤©9ç‚¹çš„ä»»åŠ¡æ”¹æˆæ¯å¤©10ç‚¹
ğŸ’¬ ä½ : ä¿®æ”¹ä»»åŠ¡ task-xxx çš„æ‰§è¡Œæ—¶é—´ä¸ºæ¯å‘¨ä¸€
```

#### æš‚åœ/æ¢å¤ä»»åŠ¡
```
ğŸ’¬ ä½ : æš‚åœä»»åŠ¡ task-xxx
ğŸ’¬ ä½ : æ¢å¤ä»»åŠ¡ task-xxx
```

#### ç«‹å³æ‰§è¡Œä»»åŠ¡
```
ğŸ’¬ ä½ : ç«‹å³æ‰§è¡Œä»»åŠ¡ task-xxx
ğŸ’¬ ä½ : ç°åœ¨å°±è¿è¡Œä»»åŠ¡ task-xxx
```

#### åˆ é™¤ä»»åŠ¡
```
ğŸ’¬ ä½ : åˆ é™¤ä»»åŠ¡ task-xxx
ğŸ’¬ ä½ : å–æ¶ˆæ¯å¤©9ç‚¹çš„å®šæ—¶ä»»åŠ¡
```

### 3. å®šæ—¶ä»»åŠ¡è‡ªåŠ¨è§¦å‘

å½“ä½ åˆ›å»ºäº†å¸¦æœ‰ `agent_prompt` çš„å®šæ—¶ä»»åŠ¡åï¼Œåˆ°è¾¾æŒ‡å®šæ—¶é—´æ—¶ï¼š

1. schedule-task-mcp ä¼šè‡ªåŠ¨è§¦å‘ä»»åŠ¡
2. é€šè¿‡ MCP Sampling æœºåˆ¶å‘é€è¯·æ±‚
3. Agent æ¥æ”¶åˆ°è¯·æ±‚å¹¶è‡ªåŠ¨æ‰§è¡Œ
4. æ‰§è¡Œç»“æœä¼šè¢«è®°å½•åˆ°ä»»åŠ¡å†å²ä¸­

**æ— éœ€äººå·¥å¹²é¢„ï¼** ğŸ‰

## å¯¹è¯æŠ€å·§

### ä½¿ç”¨æ¸…æ™°çš„æŒ‡ä»¤

âœ… å¥½çš„æŒ‡ä»¤ï¼š
```
æ£€æŸ¥æ©˜é¸¦çš„æ–°è§†é¢‘
åˆ›å»ºæ¯å¤©æ—©ä¸Š9ç‚¹çš„å®šæ—¶ä»»åŠ¡æ¥æ£€æŸ¥æ–°è§†é¢‘
åˆ—å‡ºæ‰€æœ‰å®šæ—¶ä»»åŠ¡
åˆ é™¤ä»»åŠ¡ task-1760356327548-g580l3q
```

âŒ æ¨¡ç³Šçš„æŒ‡ä»¤ï¼š
```
çœ‹çœ‹
åšç‚¹ä»€ä¹ˆ
å¸®æˆ‘
é‚£ä¸ªä»»åŠ¡
```

### ä¸€æ¬¡åšä¸€ä»¶äº‹

âœ… æ¸…æ™°ï¼š
```
ğŸ’¬ ä½ : æ£€æŸ¥æ–°è§†é¢‘
[ç­‰å¾…å“åº”]
ğŸ’¬ ä½ : å¤„ç† BV1234567890
[ç­‰å¾…å“åº”]
ğŸ’¬ ä½ : å‘é€é‚®ä»¶
```

âŒ æ··ä¹±ï¼š
```
ğŸ’¬ ä½ : æ£€æŸ¥æ–°è§†é¢‘ç„¶åå¤„ç†æ‰€æœ‰è§†é¢‘è¿˜æœ‰å‘é€é‚®ä»¶å¦å¤–åˆ›å»ºä¸ªå®šæ—¶ä»»åŠ¡
```

è™½ç„¶ Agent å¯ä»¥å¤„ç†å¤æ‚æŒ‡ä»¤ï¼Œä½†åˆ†æ­¥éª¤æ›´æ¸…æ™°ã€‚

### ä½¿ç”¨å®Œæ•´æµç¨‹

å½“ä½ æƒ³è¦å®Œæ•´çš„å·¥ä½œæµæ—¶ï¼š
```
ğŸ’¬ ä½ : æ£€æŸ¥æ©˜é¸¦çš„æ–°è§†é¢‘ï¼Œå¦‚æœæœ‰æ–°è§†é¢‘åˆ™ç”ŸæˆAIæ—©æŠ¥å¹¶å‘é€åˆ°é‚®ç®±
```

Agent ä¼šè‡ªåŠ¨ï¼š
1. æ£€æŸ¥æ–°è§†é¢‘
2. å¯¹æ¯ä¸ªæ–°è§†é¢‘ç”Ÿæˆæ—©æŠ¥
3. å‘é€é‚®ä»¶

## ç¯å¢ƒé…ç½®

### å¿…éœ€çš„ç¯å¢ƒå˜é‡

ç¡®ä¿ `.env` æ–‡ä»¶åŒ…å«ï¼š

```bash
# OpenAI APIï¼ˆå¿…éœ€ï¼‰
OPENAI_API_KEY="your-api-key"

# é‚®ä»¶é…ç½®ï¼ˆå‘é€æ—©æŠ¥æ—¶éœ€è¦ï¼‰
EMAIL_FROM="your-email@example.com"
SMTP_PASSWORD="your-smtp-password"
SMTP_SERVER="smtp.example.com"
SMTP_PORT="465"
SMTP_USE_SSL="true"
EMAIL_TO="recipient@example.com"

# GLM APIï¼ˆå¤„ç†å­—å¹•æ—¶éœ€è¦ï¼Œå¯é€‰ï¼‰
GLM_API_KEY="your-glm-key"
GLM_API_BASE_URL="https://open.bigmodel.cn/api/paas/v4"

# Schedule Task MCP é…ç½®ï¼ˆå¯é€‰ï¼Œæœ‰é»˜è®¤å€¼ï¼‰
SCHEDULE_TASK_TIMEZONE="Asia/Shanghai"
SCHEDULE_TASK_DB_PATH="/root/code/juya_openai/data/schedule_tasks.db"
SCHEDULE_TASK_SAMPLING_TIMEOUT="300000"
```

### ä»£ç†é…ç½®

å¦‚æœéœ€è¦ä»£ç†è®¿é—® OpenAI APIï¼š

```bash
# åœ¨å¯åŠ¨å‰è®¾ç½®
export http_proxy=http://127.0.0.1:1081
export https_proxy=http://127.0.0.1:1081

# æˆ–åœ¨ .env æ–‡ä»¶ä¸­é…ç½®
# chat.py ä¼šè‡ªåŠ¨è¯»å–
```

## å¸¸è§ä½¿ç”¨åœºæ™¯

### åœºæ™¯ 1: æ¯æ—¥è‡ªåŠ¨ç›‘æ§

```bash
# å¯åŠ¨å¯¹è¯æœºå™¨äºº
python chat.py
```

```
ğŸ’¬ ä½ : åˆ›å»ºæ¯å¤©æ—©ä¸Š9ç‚¹çš„å®šæ—¶ä»»åŠ¡ï¼Œæ£€æŸ¥æ©˜é¸¦çš„æ–°è§†é¢‘ï¼Œå¦‚æœæœ‰æ–°è§†é¢‘å°±ç”ŸæˆAIæ—©æŠ¥å¹¶å‘é€åˆ°æˆ‘çš„é‚®ç®±

ğŸ¤– Juya Agent: å·²æˆåŠŸåˆ›å»ºå®šæ—¶ä»»åŠ¡...
- ä»»åŠ¡ID: task-xxx
- è§¦å‘æ—¶é—´: æ¯å¤© 09:00
- ä»»åŠ¡æè¿°: æ£€æŸ¥æ©˜é¸¦çš„æ–°è§†é¢‘ï¼Œå¦‚æœæœ‰æ–°è§†é¢‘å°±ç”ŸæˆAIæ—©æŠ¥å¹¶å‘é€åˆ°é‚®ç®±

ğŸ’¬ ä½ : exit
```

ç°åœ¨ä¿æŒæœåŠ¡è¿è¡Œï¼Œæ¯å¤©æ—©ä¸Š9ç‚¹ä¼šè‡ªåŠ¨æ‰§è¡Œï¼

### åœºæ™¯ 2: ç«‹å³å¤„ç†æœ€æ–°è§†é¢‘

```bash
python chat.py
```

```
ğŸ’¬ ä½ : æ£€æŸ¥æ–°è§†é¢‘

ğŸ¤– Juya Agent: æ‰¾åˆ° 1 ä¸ªæ–°è§†é¢‘ï¼š
- BV1234567890: ã€AIèµ„è®¯ã€‘2025å¹´10æœˆ14æ—¥

ğŸ’¬ ä½ : å¤„ç†è¿™ä¸ªè§†é¢‘å¹¶å‘é€é‚®ä»¶

ğŸ¤– Juya Agent:
1. âœ… å·²ç”Ÿæˆ AI æ—©æŠ¥
2. âœ… å·²å‘é€åˆ°é‚®ç®±

ğŸ’¬ ä½ : exit
```

### åœºæ™¯ 3: ç®¡ç†å®šæ—¶ä»»åŠ¡

```bash
python chat.py
```

```
ğŸ’¬ ä½ : åˆ—å‡ºæ‰€æœ‰å®šæ—¶ä»»åŠ¡

ğŸ¤– Juya Agent: ä½ æœ‰ä»¥ä¸‹å®šæ—¶ä»»åŠ¡ï¼š
1. æ¯å¤©æ—©ä¸Š9ç‚¹æ£€æŸ¥æ–°è§†é¢‘ (task-xxx)
2. æ¯å‘¨ä¸€æ±‡æ€»è§†é¢‘ (task-yyy)

ğŸ’¬ ä½ : æš‚åœç¬¬ä¸€ä¸ªä»»åŠ¡

ğŸ¤– Juya Agent: å·²æš‚åœä»»åŠ¡ task-xxx

ğŸ’¬ ä½ : ä¸‹å‘¨å†æ¢å¤å®ƒ

ğŸ¤– Juya Agent: ä½ å¯ä»¥éšæ—¶ä½¿ç”¨ "æ¢å¤ä»»åŠ¡ task-xxx" æ¥æ¢å¤

ğŸ’¬ ä½ : exit
```

### åœºæ™¯ 4: åå°æœåŠ¡æ¨¡å¼

é€‚åˆåœ¨æœåŠ¡å™¨ä¸Šé•¿æœŸè¿è¡Œï¼š

```bash
# ä½¿ç”¨ screen æˆ– tmux
screen -S juya
python chat.py

# ç„¶å Ctrl+A, D åˆ†ç¦»ä¼šè¯

# æˆ–ä½¿ç”¨ nohup
nohup python run_with_sampling.py > juya.log 2>&1 &

# æŸ¥çœ‹æ—¥å¿—
tail -f juya.log
```

## ç‰¹æ®Šå‘½ä»¤

åœ¨å¯¹è¯æœºå™¨äººä¸­ï¼Œæœ‰ä¸€äº›ç‰¹æ®Šå‘½ä»¤ï¼š

- `exit` / `quit` / `q` - é€€å‡ºå¯¹è¯
- `clear` - æ¸…å±

## æ•…éšœæ’æŸ¥

### é—®é¢˜ 1: è¿æ¥å¤±è´¥

```
âŒ é”™è¯¯: è¿æ¥ MCP æœåŠ¡å™¨å¤±è´¥
```

**è§£å†³**ï¼šç¡®ä¿å·²å®‰è£… `schedule-task-mcp`ï¼š
```bash
npx -y schedule-task-mcp --help
```

### é—®é¢˜ 2: OpenAI API é”™è¯¯

```
âŒ é”™è¯¯: The api_key client option must be set
```

**è§£å†³**ï¼šæ£€æŸ¥ `.env` æ–‡ä»¶ä¸­çš„ `OPENAI_API_KEY` é…ç½®ã€‚

### é—®é¢˜ 3: å®šæ—¶ä»»åŠ¡æ²¡æœ‰è§¦å‘

**æ£€æŸ¥**ï¼š
1. æœåŠ¡æ˜¯å¦ä¿æŒè¿è¡Œï¼Ÿ
2. ä»»åŠ¡æ˜¯å¦å¯ç”¨ï¼Ÿï¼ˆ`enabled: true`ï¼‰
3. ä»»åŠ¡çŠ¶æ€æ˜¯å¦ä¸º `scheduled`ï¼Ÿ

**æŸ¥çœ‹**ï¼š
```
ğŸ’¬ ä½ : æŸ¥çœ‹ä»»åŠ¡ task-xxx çš„è¯¦ç»†ä¿¡æ¯
```

### é—®é¢˜ 4: é‚®ä»¶å‘é€å¤±è´¥

```
âŒ å‘é€é‚®ä»¶å¤±è´¥
```

**æ£€æŸ¥**ï¼š
1. `.env` ä¸­çš„é‚®ä»¶é…ç½®æ˜¯å¦æ­£ç¡®
2. SMTP æœåŠ¡å™¨æ˜¯å¦å¯è®¿é—®
3. å¯†ç æ˜¯å¦æ­£ç¡®ï¼ˆæŸäº›é‚®ç®±éœ€è¦ä¸“ç”¨å¯†ç ï¼‰

## é«˜çº§ç”¨æ³•

### ç¼–ç¨‹æ–¹å¼ä½¿ç”¨

å¦‚æœä½ æƒ³åœ¨è‡ªå·±çš„ä»£ç ä¸­é›†æˆï¼š

```python
import asyncio
from manager import JuyaManager

async def main():
    manager = JuyaManager()

    # æ–¹å¼1: å•æ¬¡æ‰§è¡Œ
    result = await manager.run("æ£€æŸ¥æ–°è§†é¢‘")
    print(result)

    # æ–¹å¼2: å¸¦ sampling æ”¯æŒ
    result = await manager.run_with_sampling(
        user_query="åˆ›å»ºå®šæ—¶ä»»åŠ¡",
        keep_alive=True  # ä¿æŒè¿è¡Œ
    )

asyncio.run(main())
```

### è‡ªå®šä¹‰ Agent

ä¿®æ”¹ `juya_agents.py` ä¸­çš„ `orchestrator_agent` é…ç½®ï¼š

```python
orchestrator_agent = Agent(
    name="juya_orchestrator",
    instructions="ä½ è‡ªå®šä¹‰çš„æŒ‡ä»¤...",
    model="gpt-4o-mini",  # æˆ–å…¶ä»–æ¨¡å‹
    tools=[
        check_new_videos,
        process_video,
        send_email_report,
        # ä½ çš„è‡ªå®šä¹‰å·¥å…·
    ]
)
```

## æ€»ç»“

Juya Agent æä¾›äº†ä¸‰ç§ä½¿ç”¨æ–¹å¼ï¼š

1. **å¯¹è¯æœºå™¨äºº**ï¼ˆ`chat.py`ï¼‰- æœ€å‹å¥½ï¼Œé€‚åˆäº¤äº’ä½¿ç”¨
2. **å‘½ä»¤è¡Œ**ï¼ˆ`run_with_sampling.py`ï¼‰- é€‚åˆè„šæœ¬åŒ–
3. **ç¼–ç¨‹æ¥å£**ï¼ˆ`manager.py`ï¼‰- é€‚åˆé›†æˆåˆ°å…¶ä»–ç³»ç»Ÿ

é€‰æ‹©æœ€é€‚åˆä½ çš„æ–¹å¼ï¼Œäº«å— AI Agent å¸¦æ¥çš„è‡ªåŠ¨åŒ–ä½“éªŒï¼ğŸš€
